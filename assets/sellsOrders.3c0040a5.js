import{bm as n,b3 as o,b4 as l,bn as a,aZ as p}from"./index.b5420dcf.js";import{m as c}from"./moment.6005d801.js";import{u as h}from"./report.3d39650f.js";const b=n("sellsOrders",{state:()=>({activeTab:"tab1",selectedTab:0,selectedItems:0,totalTab:1,orders:[{title:"customer1",icon:"mdi-account-outline",tab:"tab1",customer_id:"5947456742",order_date:c().format("YYYY-MM-DD"),order_code:"SO-"+c().format("DD")+"00",items:[{product_id:null,quantity:null,unit_price:null,total_price:null}],subtotal:0,labour:0,discount:0,collection:0,total:0,pay:0,balance:0,errors:[],warnings:[]}],status:0,selectedUpdateOrder:0,selectedUpdateOrderItem:0,updateOrders:[]}),getters:{order:e=>e.orders[e.selectedTab],item:e=>e.orders[e.selectedTab].items[e.selectedItems],updateOrder:e=>e.updateOrders.find(t=>t.order_code==e.selectedUpdateOrder),updateItem:e=>e.updateOrders.find(s=>s.order_code==e.selectedUpdateOrder).items.find(s=>s.item_id==e.selectedUpdateOrderItem)},actions:{setUnitType(e){this.unitType=this.createSelectData(e,"name","unit_id")},setCategoryList(e){this.categories=this.createSelectData(e,"name","category_id")},setProductTypeList(e){this.productTypes=e},async updateProductList(e){let t=await o.get(l.getProductList);this.productList=t.data.data},createSelectData(e,t,s){return e.map(r=>({title:r[t],value:r[s]}))},addProductItem(){this.selectedItems++,this.orders[this.selectedTab].items.push({product_id:null,quantity:0,unit_price:0,total_price:0})},addUpdateProductItem(){this.updateOrders.find(t=>t.order_code==this.selectedUpdateOrder).items.push({product_id:null,quantity:0,unit_price:0,total_price:0})},addTab(){this.totalTab++;let e=this.totalTab;this.orders.push({title:`customer${e}`,icon:"mdi-account-outline",tab:`tab${e}`,items:[{product_id:null,quantity:null,unit_price:null,total_price:null}],subtotal:0,labour:0,discount:0,collection:0,total:0,pay:0,balance:0,errors:[],warnings:[]})},selectTab(e){this.selectedTab=e,this.activeTab=this.orders[e].tab},updateProductData(){let e=0;this.order.items.forEach(t=>{e=e+t.total_price}),this.order.subtotal=e,this.order.total=e-this.order.discount,this.order.balance=this.order.total-this.order.pay,this.order.total=this.order.subtotal+this.order.labour+this.order.collection-this.order.discount,this.order.pay=this.order.total,this.order.balance=this.order.total-this.order.pay},updateBalance(){this.order.balance=this.order.total-this.order.pay},async payment(){if(this.order.errors.length){this.order.errors.forEach(t=>{a.toast("error",t.message)});return}let e=this;await o.post(l.salesOrderStore,this.order).then(function(t){t.data.status?(e.resetOrder(),p().updateProductList(),a.toast("success","Sales order create successfully")):a.toast("error",t.data.message)}).catch(function(t){})},async updateOrderPayment(){let e=this,t=this.updateOrders.find(r=>r.order_code==this.selectedUpdateOrder),s=l.salesOrderStore+"/"+t.sales_order_id;await o.put(s,t).then(function(r){r.status?(a.toast("success","Sales order update successfully"),e.resetOrder()):a.toast("error","Sales order update fail")}).catch(function(r){})},resetOrder(){this.orders[this.selectedTab].items=[];let e=this;setTimeout(()=>{e.addProductItem()},100),this.orders[this.selectedTab].subtotal=0,this.orders[this.selectedTab].discount=0,this.orders[this.selectedTab].total=0,this.orders[this.selectedTab].pay=0,this.orders[this.selectedTab].balance=0,this.orders[this.selectedTab].labour=0,this.orders[this.selectedTab].collection=0},async addUpdateOrder(e){let t=this.updateOrders.find(r=>r.order_code==e),s=null;if(t)this.selectedUpdateOrder=e,this.updateOrder.items[0].item_id;else{let r=await o.get(l.salesOrderDetails+"/"+e);r=r.data.data;let i=[];r.order_details.forEach(d=>{s||(s=d.sales_order_item_id),i.push({item_id:d.sales_order_item_id,product_id:d.product_id,quantity:d.qty,unit_price:d.selling_price,total_price:d.total_selling_price})}),this.updateOrders.push({sales_order_id:r.sales_order_id,order_code:e,customer_id:r.customer_id,customer_contact:r.customer_contact,order_date:r.order_date,items:i,subtotal:r.order_amount,labour:r.labour,discount:r.discount,collection:r.collection,total:r.payable_amount,pay:r.payment,balance:r.payable_amount-r.payment}),this.selectedUpdateOrder=e}this.selectedUpdateOrderItem=s},updateEditProductData(){let e=0;this.updateOrder.items.forEach(t=>{e=e+t.total_price}),this.updateOrder.subtotal=e,this.updateOrder.total=e-this.updateOrder.discount,this.updateOrder.balance=this.updateOrder.total-this.updateOrder.pay,this.updateOrder.total=this.updateOrder.subtotal+this.updateOrder.labour+this.updateOrder.collection-this.updateOrder.discount,this.updateOrder.pay=this.updateOrder.total,this.updateOrder.balance=this.updateOrder.total-this.updateOrder.pay},updateEditBalance(){this.updateOrder.balance=this.updateOrder.total-this.updateOrder.pay},removeEditItem(e){if(this.updateOrder&&this.updateOrder.items.length>1){let t=this.updateOrder.items.findIndex(s=>s.item_id==e);this.updateOrder.items.splice(t,1),this.selectedUpdateOrderItem=this.updateOrder.items[0].item_id,this.updateEditProductData()}},async removeOrder(e){try{a.delete().then(async t=>{if(t.isConfirmed){let s=l.salesOrderEdit+"/"+e;if((await o.delete(s)).data.status){const i=h();let d=i.salesOrderList.items.findIndex(u=>u.sales_order_id==e);i.salesOrderList.items.splice(d,1),await i.getOrderList(),a.toast("success","Sales order delete successfully")}}})}catch(t){console.log(t)}}}});export{b as u};
